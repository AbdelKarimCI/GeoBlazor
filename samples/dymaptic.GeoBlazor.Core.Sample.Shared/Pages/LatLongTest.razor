@page "/lat-long-test"

<PageTitle>Graphic Tracking</PageTitle>

<MapView @ref="_view" Class="map-view"  OnClick="OnMapClick">
    <Extent Xmax="@_xmax" Xmin="@_xmin" Ymax="@_ymax" Ymin="@_ymin" />
    <SpatialReference Wkid="3857" />
    <Map ArcGISDefaultBasemap="arcgis-navigation">
        <GraphicsLayer @ref="_graphicsLayer">
        </GraphicsLayer>
        <GraphicsLayer @ref="_drawing">
            @if (_mapRings != null)
            {
                <Graphic @ref="_polygonGraphic">
                    <Polygon Rings="@(new[] { _mapRings })" />
                    <SimpleFillSymbol Color="@(new MapColor(81, 46, 132, 0.8))">
                        <Outline Color="@(new MapColor(81, 46, 132))" Width="2" />
                    </SimpleFillSymbol>
                </Graphic>
            }
        </GraphicsLayer>
    </Map>
</MapView>
@code
{
    private MapPath _mapPath = new();
    private List<MapPoint> _mapPoint = new List<MapPoint>();
    private readonly MapPath _mapRings = new();
    private GraphicsLayer _drawing = new();
    private Graphic _polygonGraphic = new();

    private double _xmax = 42757606.71337592;
    private double _xmin = -20407507.47657203;
    private double _ymax = 14638420.691542711;
    private double _ymin = -8843034.397657271;

    private async Task OnMapClick(ClickEvent clickEvent)
    {
        MapPoint point = new MapPoint(clickEvent.MapPoint.Longitude.Value, clickEvent.MapPoint.Latitude.Value, clickEvent.MapPoint.X.Value, clickEvent.MapPoint.Y.Value);
        _mapRings.Add(point);
        await _polygonGraphic.SetGeometry(new Polygon(new[] { _mapRings }));
    }

    private bool _mapRendered;
    private MapView? _view;
    private GraphicsLayer? _graphicsLayer;
}